{"ast":null,"code":"var _jsxFileName = \"/home/luis/Escritorio/telefonica2/nft_marketplace/src/frontend/components/MyPurchases.js\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect } from 'react';\nimport { ethers } from \"ethers\";\nimport { Row, Col, Card } from 'react-bootstrap';\nimport { convertUriFormat } from './uriUtils.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function MyPurchases(_ref) {\n  _s();\n\n  let {\n    marketplace,\n    nft,\n    account\n  } = _ref;\n  const [loading, setLoading] = useState(true);\n  const [purchases, setPurchases] = useState([]);\n\n  const loadPurchasedItems = async () => {\n    // Fetch purchased items from marketplace by quering Offered events with the buyer set as the user\n    const filter = marketplace.filters.Bought(null, null, null, null, null, account);\n    const results = await marketplace.queryFilter(filter); //Fetch metadata of each nft and add that to listedItem object.\n\n    const purchases = await Promise.all(results.map(async i => {\n      // fetch arguments from each result\n      i = i.args; // get uri url from nft contract\n\n      const newUri = await nft.tokenURI(item.tokenId);\n      const uri = convertUriFormat(newUri);\n      const response = await fetch(uri);\n      const metadata = await response.json(); // get total price of item (item price + fee)\n\n      const totalPrice = await marketplace.getTotalPrice(i.itemId); // define listed item object\n\n      const imageUri = convertUriFormat(metadata.image);\n      let purchasedItem = {\n        totalPrice,\n        price: i.price,\n        itemId: i.itemId,\n        name: metadata.name,\n        description: metadata.description,\n        image: imageUri\n      };\n      return purchasedItem;\n    }));\n    setLoading(false);\n    setPurchases(purchases);\n  };\n\n  useEffect(() => {\n    loadPurchasedItems();\n  }, []);\n  if (loading) return /*#__PURE__*/_jsxDEV(\"main\", {\n    style: {\n      padding: \"1rem 0\"\n    },\n    children: /*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 45,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 44,\n    columnNumber: 5\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex justify-center\",\n    children: purchases.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"px-5 container\",\n      children: /*#__PURE__*/_jsxDEV(Row, {\n        xs: 1,\n        md: 2,\n        lg: 4,\n        className: \"g-4 py-5\",\n        children: purchases.map((item, idx) => /*#__PURE__*/_jsxDEV(Col, {\n          className: \"overflow-hidden\",\n          children: /*#__PURE__*/_jsxDEV(Card, {\n            children: [/*#__PURE__*/_jsxDEV(Card.Img, {\n              variant: \"top\",\n              src: item.image\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 56,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(Card.Footer, {\n              children: [ethers.utils.formatEther(item.totalPrice), \" ETH\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 57,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 55,\n            columnNumber: 17\n          }, this)\n        }, idx, false, {\n          fileName: _jsxFileName,\n          lineNumber: 54,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 52,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 51,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"main\", {\n      style: {\n        padding: \"1rem 0\"\n      },\n      children: /*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"No purchases\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 65,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 11\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 49,\n    columnNumber: 5\n  }, this);\n}\n\n_s(MyPurchases, \"+bT9nvXJXwVwMkewhHc+Eyc0m60=\");\n\n_c = MyPurchases;\n\nvar _c;\n\n$RefreshReg$(_c, \"MyPurchases\");","map":{"version":3,"sources":["/home/luis/Escritorio/telefonica2/nft_marketplace/src/frontend/components/MyPurchases.js"],"names":["useState","useEffect","ethers","Row","Col","Card","convertUriFormat","MyPurchases","marketplace","nft","account","loading","setLoading","purchases","setPurchases","loadPurchasedItems","filter","filters","Bought","results","queryFilter","Promise","all","map","i","args","newUri","tokenURI","item","tokenId","uri","response","fetch","metadata","json","totalPrice","getTotalPrice","itemId","imageUri","image","purchasedItem","price","name","description","padding","length","idx","utils","formatEther"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react'\nimport { ethers } from \"ethers\"\nimport { Row, Col, Card } from 'react-bootstrap'\nimport { convertUriFormat } from './uriUtils.js';\n\nexport default function MyPurchases({ marketplace, nft, account }) {\n  const [loading, setLoading] = useState(true)\n  const [purchases, setPurchases] = useState([])\n  const loadPurchasedItems = async () => {\n    // Fetch purchased items from marketplace by quering Offered events with the buyer set as the user\n    const filter =  marketplace.filters.Bought(null,null,null,null,null,account)\n    const results = await marketplace.queryFilter(filter)\n    //Fetch metadata of each nft and add that to listedItem object.\n    const purchases = await Promise.all(results.map(async i => {\n      // fetch arguments from each result\n      i = i.args\n      // get uri url from nft contract\n      const newUri = await nft.tokenURI(item.tokenId)\n      const uri = convertUriFormat(newUri)\n      const response = await fetch(uri)\n      const metadata = await response.json()\n      // get total price of item (item price + fee)\n      const totalPrice = await marketplace.getTotalPrice(i.itemId)\n      // define listed item object\n      const imageUri = convertUriFormat(metadata.image) \n\n      let purchasedItem = {\n        totalPrice,\n        price: i.price,\n        itemId: i.itemId,\n        name: metadata.name,\n        description: metadata.description,\n        image: imageUri\n      }\n      return purchasedItem\n    }))\n    setLoading(false)\n    setPurchases(purchases)\n  }\n  useEffect(() => {\n    loadPurchasedItems()\n  }, [])\n  if (loading) return (\n    <main style={{ padding: \"1rem 0\" }}>\n      <h2>Loading...</h2>\n    </main>\n  )\n  return (\n    <div className=\"flex justify-center\">\n      {purchases.length > 0 ?\n        <div className=\"px-5 container\">\n          <Row xs={1} md={2} lg={4} className=\"g-4 py-5\">\n            {purchases.map((item, idx) => (\n              <Col key={idx} className=\"overflow-hidden\">\n                <Card>\n                  <Card.Img variant=\"top\" src={item.image} />\n                  <Card.Footer>{ethers.utils.formatEther(item.totalPrice)} ETH</Card.Footer>\n                </Card>\n              </Col>\n            ))}\n          </Row>\n        </div>\n        : (\n          <main style={{ padding: \"1rem 0\" }}>\n            <h2>No purchases</h2>\n          </main>\n        )}\n    </div>\n  );\n}"]},"metadata":{},"sourceType":"module"}