{"ast":null,"code":"var _jsxFileName = \"/home/luis/Escritorio/telefonica3/nft_marketplace3/src/frontend/components/Home.js\",\n  _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nimport { ethers } from \"ethers\";\nimport { Row, Col, Card, Button } from 'react-bootstrap';\nimport { convertUriFormat } from './uriUtils.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Home = _ref => {\n  _s();\n  let {\n    marketplace,\n    nft\n  } = _ref;\n  const [loading, setLoading] = useState(true);\n  console.log(nft);\n  console.log(marketplace);\n  const [items, setItems] = useState([]);\n  const loadMarketplaceItems = async () => {\n    // Load all unsold items\n    const itemCount = await marketplace.itemCount();\n    let items = [];\n    for (let i = 1; i <= itemCount; i++) {\n      const item = await marketplace.items(i);\n      console.log(items);\n      if (!item.sold) {\n        // get uri url from nft contract\n        const newUri = await nft.tokenURI(item.tokenId);\n        const uri = convertUriFormat(newUri);\n        const response = await fetch(uri);\n        const metadata = await response.json();\n        // get total price of item (item price + fee)\n        const totalPrice = await marketplace.getTotalPrice(item.itemId);\n        const imageUri = convertUriFormat(metadata.image);\n        // Add item to items array\n        items.push({\n          totalPrice,\n          itemId: item.itemId,\n          seller: item.seller,\n          name: metadata.name,\n          description: metadata.description,\n          image: imageUri\n        });\n      }\n    }\n    setLoading(false);\n    setItems(items);\n  };\n  const buyMarketItem = async item => {\n    await (await marketplace.purchaseItem(item.itemId, {\n      value: item.totalPrice\n    })).wait();\n    loadMarketplaceItems();\n  };\n  useEffect(() => {\n    loadMarketplaceItems();\n  }, []);\n  if (loading) return /*#__PURE__*/_jsxDEV(\"main\", {\n    style: {\n      padding: \"1rem 0\"\n    },\n    children: /*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 51,\n    columnNumber: 5\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex justify-center\",\n    children: items.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"px-5 container\",\n      children: /*#__PURE__*/_jsxDEV(Row, {\n        xs: 1,\n        md: 2,\n        lg: 4,\n        className: \"g-4 py-5\",\n        children: items.map((item, idx) => /*#__PURE__*/_jsxDEV(Col, {\n          className: \"overflow-hidden\",\n          children: /*#__PURE__*/_jsxDEV(Card, {\n            children: [/*#__PURE__*/_jsxDEV(Card.Img, {\n              variant: \"top\",\n              src: item.image\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 63,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(Card.Body, {\n              color: \"secondary\",\n              children: [/*#__PURE__*/_jsxDEV(Card.Title, {\n                children: item.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 65,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Card.Text, {\n                children: item.description\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 66,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 64,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(Card.Footer, {\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"d-grid\",\n                children: /*#__PURE__*/_jsxDEV(Button, {\n                  onClick: () => buyMarketItem(item),\n                  variant: \"primary\",\n                  size: \"lg\",\n                  children: [\"Buy for \", ethers.utils.formatEther(item.totalPrice), \" ETH\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 72,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 71,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 70,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 62,\n            columnNumber: 17\n          }, this)\n        }, idx, false, {\n          fileName: _jsxFileName,\n          lineNumber: 61,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 59,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"main\", {\n      style: {\n        padding: \"1rem 0\"\n      },\n      children: /*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"No listed assets\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 11\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 56,\n    columnNumber: 5\n  }, this);\n};\n_s(Home, \"X4x04bf2XOIdWC9JIzBW7u2/seA=\");\n_c = Home;\nexport default Home;\nvar _c;\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"names":["useState","useEffect","ethers","Row","Col","Card","Button","convertUriFormat","jsxDEV","_jsxDEV","Home","_ref","_s","marketplace","nft","loading","setLoading","console","log","items","setItems","loadMarketplaceItems","itemCount","i","item","sold","newUri","tokenURI","tokenId","uri","response","fetch","metadata","json","totalPrice","getTotalPrice","itemId","imageUri","image","push","seller","name","description","buyMarketItem","purchaseItem","value","wait","style","padding","children","fileName","_jsxFileName","lineNumber","columnNumber","className","length","xs","md","lg","map","idx","Img","variant","src","Body","color","Title","Text","Footer","onClick","size","utils","formatEther","_c","$RefreshReg$"],"sources":["/home/luis/Escritorio/telefonica3/nft_marketplace3/src/frontend/components/Home.js"],"sourcesContent":["import { useState, useEffect } from 'react'\nimport { ethers } from \"ethers\"\nimport { Row, Col, Card, Button } from 'react-bootstrap'\nimport { convertUriFormat } from './uriUtils.js';\n\nconst Home = ({ marketplace, nft }) => {\n  const [loading, setLoading] = useState(true)\n  console.log(nft)\n  console.log(marketplace)\n  const [items, setItems] = useState([])\n  const loadMarketplaceItems = async () => {\n    // Load all unsold items\n    const itemCount = await marketplace.itemCount()\n    let items = []\n    for (let i = 1; i <= itemCount; i++) {\n      const item = await marketplace.items(i)\n      console.log(items)\n      if (!item.sold) {\n        // get uri url from nft contract\n        const newUri = await nft.tokenURI(item.tokenId)\n        const uri = convertUriFormat(newUri)\n        const response = await fetch(uri)\n        const metadata = await response.json()\n        // get total price of item (item price + fee)\n        const totalPrice = await marketplace.getTotalPrice(item.itemId)\n        const imageUri = convertUriFormat(metadata.image) \n        // Add item to items array\n        items.push({\n          totalPrice,\n          itemId: item.itemId,\n          seller: item.seller,\n          name: metadata.name,\n          description: metadata.description,\n          image: imageUri\n        })\n      }\n    }\n    setLoading(false)\n    setItems(items)\n  }\n\n  const buyMarketItem = async (item) => {\n    await (await marketplace.purchaseItem(item.itemId, { value: item.totalPrice })).wait()\n    loadMarketplaceItems()\n  }\n\n  useEffect(() => {\n    loadMarketplaceItems()\n  }, [])\n  if (loading) return (\n    <main style={{ padding: \"1rem 0\" }}>\n      <h2>Loading...</h2>\n    </main>\n  )\n  return (\n    <div className=\"flex justify-center\">\n      {items.length > 0 ?\n        <div className=\"px-5 container\">\n          <Row xs={1} md={2} lg={4} className=\"g-4 py-5\">\n            {items.map((item, idx) => (\n              <Col key={idx} className=\"overflow-hidden\">\n                <Card>\n                  <Card.Img variant=\"top\" src={item.image} />\n                  <Card.Body color=\"secondary\">\n                    <Card.Title>{item.name}</Card.Title>\n                    <Card.Text>\n                      {item.description}\n                    </Card.Text>\n                  </Card.Body>\n                  <Card.Footer>\n                    <div className='d-grid'>\n                      <Button onClick={() => buyMarketItem(item)} variant=\"primary\" size=\"lg\">\n                        Buy for {ethers.utils.formatEther(item.totalPrice)} ETH\n                      </Button>\n                    </div>\n                  </Card.Footer>\n                </Card>\n              </Col>\n            ))}\n          </Row>\n        </div>\n        : (\n          <main style={{ padding: \"1rem 0\" }}>\n            <h2>No listed assets</h2>\n          </main>\n        )}\n    </div>\n  );\n}\nexport default Home"],"mappings":";;AAAA,SAASA,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAC3C,SAASC,MAAM,QAAQ,QAAQ;AAC/B,SAASC,GAAG,EAAEC,GAAG,EAAEC,IAAI,EAAEC,MAAM,QAAQ,iBAAiB;AACxD,SAASC,gBAAgB,QAAQ,eAAe;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEjD,MAAMC,IAAI,GAAGC,IAAA,IAA0B;EAAAC,EAAA;EAAA,IAAzB;IAAEC,WAAW;IAAEC;EAAI,CAAC,GAAAH,IAAA;EAChC,MAAM,CAACI,OAAO,EAAEC,UAAU,CAAC,GAAGhB,QAAQ,CAAC,IAAI,CAAC;EAC5CiB,OAAO,CAACC,GAAG,CAACJ,GAAG,CAAC;EAChBG,OAAO,CAACC,GAAG,CAACL,WAAW,CAAC;EACxB,MAAM,CAACM,KAAK,EAAEC,QAAQ,CAAC,GAAGpB,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAMqB,oBAAoB,GAAG,MAAAA,CAAA,KAAY;IACvC;IACA,MAAMC,SAAS,GAAG,MAAMT,WAAW,CAACS,SAAS,CAAC,CAAC;IAC/C,IAAIH,KAAK,GAAG,EAAE;IACd,KAAK,IAAII,CAAC,GAAG,CAAC,EAAEA,CAAC,IAAID,SAAS,EAAEC,CAAC,EAAE,EAAE;MACnC,MAAMC,IAAI,GAAG,MAAMX,WAAW,CAACM,KAAK,CAACI,CAAC,CAAC;MACvCN,OAAO,CAACC,GAAG,CAACC,KAAK,CAAC;MAClB,IAAI,CAACK,IAAI,CAACC,IAAI,EAAE;QACd;QACA,MAAMC,MAAM,GAAG,MAAMZ,GAAG,CAACa,QAAQ,CAACH,IAAI,CAACI,OAAO,CAAC;QAC/C,MAAMC,GAAG,GAAGtB,gBAAgB,CAACmB,MAAM,CAAC;QACpC,MAAMI,QAAQ,GAAG,MAAMC,KAAK,CAACF,GAAG,CAAC;QACjC,MAAMG,QAAQ,GAAG,MAAMF,QAAQ,CAACG,IAAI,CAAC,CAAC;QACtC;QACA,MAAMC,UAAU,GAAG,MAAMrB,WAAW,CAACsB,aAAa,CAACX,IAAI,CAACY,MAAM,CAAC;QAC/D,MAAMC,QAAQ,GAAG9B,gBAAgB,CAACyB,QAAQ,CAACM,KAAK,CAAC;QACjD;QACAnB,KAAK,CAACoB,IAAI,CAAC;UACTL,UAAU;UACVE,MAAM,EAAEZ,IAAI,CAACY,MAAM;UACnBI,MAAM,EAAEhB,IAAI,CAACgB,MAAM;UACnBC,IAAI,EAAET,QAAQ,CAACS,IAAI;UACnBC,WAAW,EAAEV,QAAQ,CAACU,WAAW;UACjCJ,KAAK,EAAED;QACT,CAAC,CAAC;MACJ;IACF;IACArB,UAAU,CAAC,KAAK,CAAC;IACjBI,QAAQ,CAACD,KAAK,CAAC;EACjB,CAAC;EAED,MAAMwB,aAAa,GAAG,MAAOnB,IAAI,IAAK;IACpC,MAAM,CAAC,MAAMX,WAAW,CAAC+B,YAAY,CAACpB,IAAI,CAACY,MAAM,EAAE;MAAES,KAAK,EAAErB,IAAI,CAACU;IAAW,CAAC,CAAC,EAAEY,IAAI,CAAC,CAAC;IACtFzB,oBAAoB,CAAC,CAAC;EACxB,CAAC;EAEDpB,SAAS,CAAC,MAAM;IACdoB,oBAAoB,CAAC,CAAC;EACxB,CAAC,EAAE,EAAE,CAAC;EACN,IAAIN,OAAO,EAAE,oBACXN,OAAA;IAAMsC,KAAK,EAAE;MAAEC,OAAO,EAAE;IAAS,CAAE;IAAAC,QAAA,eACjCxC,OAAA;MAAAwC,QAAA,EAAI;IAAU;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACf,CAAC;EAET,oBACE5C,OAAA;IAAK6C,SAAS,EAAC,qBAAqB;IAAAL,QAAA,EACjC9B,KAAK,CAACoC,MAAM,GAAG,CAAC,gBACf9C,OAAA;MAAK6C,SAAS,EAAC,gBAAgB;MAAAL,QAAA,eAC7BxC,OAAA,CAACN,GAAG;QAACqD,EAAE,EAAE,CAAE;QAACC,EAAE,EAAE,CAAE;QAACC,EAAE,EAAE,CAAE;QAACJ,SAAS,EAAC,UAAU;QAAAL,QAAA,EAC3C9B,KAAK,CAACwC,GAAG,CAAC,CAACnC,IAAI,EAAEoC,GAAG,kBACnBnD,OAAA,CAACL,GAAG;UAAWkD,SAAS,EAAC,iBAAiB;UAAAL,QAAA,eACxCxC,OAAA,CAACJ,IAAI;YAAA4C,QAAA,gBACHxC,OAAA,CAACJ,IAAI,CAACwD,GAAG;cAACC,OAAO,EAAC,KAAK;cAACC,GAAG,EAAEvC,IAAI,CAACc;YAAM;cAAAY,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC,eAC3C5C,OAAA,CAACJ,IAAI,CAAC2D,IAAI;cAACC,KAAK,EAAC,WAAW;cAAAhB,QAAA,gBAC1BxC,OAAA,CAACJ,IAAI,CAAC6D,KAAK;gBAAAjB,QAAA,EAAEzB,IAAI,CAACiB;cAAI;gBAAAS,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAa,CAAC,eACpC5C,OAAA,CAACJ,IAAI,CAAC8D,IAAI;gBAAAlB,QAAA,EACPzB,IAAI,CAACkB;cAAW;gBAAAQ,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACR,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACH,CAAC,eACZ5C,OAAA,CAACJ,IAAI,CAAC+D,MAAM;cAAAnB,QAAA,eACVxC,OAAA;gBAAK6C,SAAS,EAAC,QAAQ;gBAAAL,QAAA,eACrBxC,OAAA,CAACH,MAAM;kBAAC+D,OAAO,EAAEA,CAAA,KAAM1B,aAAa,CAACnB,IAAI,CAAE;kBAACsC,OAAO,EAAC,SAAS;kBAACQ,IAAI,EAAC,IAAI;kBAAArB,QAAA,GAAC,UAC9D,EAAC/C,MAAM,CAACqE,KAAK,CAACC,WAAW,CAAChD,IAAI,CAACU,UAAU,CAAC,EAAC,MACrD;gBAAA;kBAAAgB,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAQ;cAAC;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACN;YAAC;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACK,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACV;QAAC,GAhBCO,GAAG;UAAAV,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAiBR,CACN;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACC;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CAAC,gBAEJ5C,OAAA;MAAMsC,KAAK,EAAE;QAAEC,OAAO,EAAE;MAAS,CAAE;MAAAC,QAAA,eACjCxC,OAAA;QAAAwC,QAAA,EAAI;MAAgB;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAI;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACrB;EACP;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACA,CAAC;AAEV,CAAC;AAAAzC,EAAA,CAnFKF,IAAI;AAAA+D,EAAA,GAAJ/D,IAAI;AAoFV,eAAeA,IAAI;AAAA,IAAA+D,EAAA;AAAAC,YAAA,CAAAD,EAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}